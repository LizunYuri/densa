Описание
Данный код реализует маршруты для аутентификации пользователя в приложении на базе FastAPI. Реализованы следующие функции:

Логин с использованием JWT-токенов.
Проверка авторизации пользователя на защищённом маршруте.
Логаут пользователя с удалением токена.
Код также включает:

Использование библиотеки passlib для работы с хешированием паролей.
Использование jose для создания и валидации JWT-токенов.
Управление подключением к базе данных через объект Database.
Переменные конфигурации
SECRET_KEY: секретный ключ для подписания JWT-токенов.
ALGORITHM: алгоритм для шифрования токенов (HS256).
ACCESS_TOKEN_EXPIRE_MINUTES: время жизни токена в минутах (120 минут).
Компоненты
1. Маршрутизатор
Создан объект router из APIRouter, который объединяет маршруты.

2. Хеширование паролей
Используется объект pwd_context с алгоритмом bcrypt.

3. Модели
LoginRequest
Модель для запроса логина:

username (str): имя пользователя.
password (str): пароль.
4. Функции
get_database()
Назначение: Управляет подключением к базе данных.
Описание: Открывает соединение с базой перед использованием и закрывает после выполнения задачи.
Возвращаемое значение: Объект Database.
create_access_token(data: dict, expires_delta: timedelta = None)
Назначение: Создает JWT-токен.
Аргументы:
data: данные для кодирования (например, username).
expires_delta: время жизни токена.
Возвращаемое значение: Закодированный JWT-токен.
get_current_user(request: Request)
Назначение: Проверяет валидность токена.
Аргументы:
request: объект запроса с cookie.
Возвращаемое значение:
True, если токен валиден.
False, если токен отсутствует или недействителен.
Маршруты
1. POST /login
Описание: Обрабатывает запрос на вход пользователя.
Аргументы:
request (LoginRequest): данные пользователя.
response (Response): объект ответа.
db (Database): подключение к базе данных (через Depends).
Логика:
Проверяет, существует ли пользователь в базе.
Сравнивает хеш пароля.
Создает JWT-токен при успешной проверке.
Устанавливает токен в cookie.
Ответы:
200 OK: Успешный вход.
400 Bad Request: Некорректное имя пользователя или пароль.
2. GET /protected
Описание: Защищённый маршрут, доступный только авторизованным пользователям.
Аргументы:
is_valid (bool): результат проверки токена (через Depends).
Ответ:
200 OK: Возвращает статус аутентификации пользователя.
3. POST /logout
Описание: Удаляет токен из cookie.
Аргументы:
response (Response): объект ответа.
Ответ:
200 OK: Сообщение об успешном выходе.
Особенности реализации
1. JWT-токен
Создается с использованием:
sub (subject): имя пользователя.
exp: время истечения срока действия токена.
2. Cookie
Используются для хранения токена:
httponly: предотвращает доступ к cookie из JavaScript.
samesite='strict': ограничивает отправку cookie кросс-доменными запросами.
secure: (не используется в коде) опция для HTTPS.
3. Ошибки
Используется HTTPException для обработки ошибок:
Статус 400 для неверных данных аутентификации.